---
import Layout from '../layouts/Layout.astro';
import ApiDemo from '../components/react/ApiDemo';

// Demo page for testing the HTTP + TanStack Query approach
const pageTitle = 'HTTP + TanStack Query Demo | Webler';
const pageDescription = 'Demonstrate the new HTTP-based API approach with polling for website generation tracking.';
---

<Layout title={pageTitle} description={pageDescription}>
  <main class="min-h-screen bg-gray-50 py-12">
    <!-- Demo Header -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mb-12">
      <div class="text-center">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">
          HTTP + TanStack Query Demo
        </h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
          Experience the new architecture: HTTP polling replaces WebSocket for better reliability and alignment with GitHub Actions workflow.
        </p>
      </div>
    </div>

    <!-- Architecture Comparison -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
      <div class="bg-white rounded-lg shadow p-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Architecture Evolution</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-medium text-red-600 mb-2">‚ùå Previous: WebSocket Approach</h3>
            <ul class="text-sm text-gray-600 space-y-1">
              <li>‚Ä¢ Real-time WebSocket connections</li>
              <li>‚Ä¢ Assumed live server providing updates</li>
              <li>‚Ä¢ Complex connection management</li>
              <li>‚Ä¢ Potential reliability issues</li>
              <li>‚Ä¢ Misaligned with GitHub Actions workflow</li>
            </ul>
          </div>
          <div>
            <h3 class="font-medium text-green-600 mb-2">‚úÖ Current: HTTP + TanStack Query</h3>
            <ul class="text-sm text-gray-600 space-y-1">
              <li>‚Ä¢ HTTP polling with smart caching</li>
              <li>‚Ä¢ Aligns with GitHub Actions workflow</li>
              <li>‚Ä¢ Built-in retry and error handling</li>
              <li>‚Ä¢ Better mobile and offline support</li>
              <li>‚Ä¢ Simpler testing and debugging</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- TanStack Query Features -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mb-8">
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-blue-900 mb-3">
          TanStack Query Features
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-medium text-blue-800 mb-2">üîÑ Smart Caching & Polling</h4>
            <ul class="text-sm text-blue-700 space-y-1">
              <li>‚Ä¢ Automatic background updates</li>
              <li>‚Ä¢ Intelligent cache invalidation</li>
              <li>‚Ä¢ Polling stops when generation completes</li>
              <li>‚Ä¢ Optimistic updates for better UX</li>
            </ul>
          </div>
          <div>
            <h4 class="font-medium text-blue-800 mb-2">üõ°Ô∏è Error Handling & Retry</h4>
            <ul class="text-sm text-blue-700 space-y-1">
              <li>‚Ä¢ Exponential backoff retry logic</li>
              <li>‚Ä¢ Network error detection</li>
              <li>‚Ä¢ Offline/online status awareness</li>
              <li>‚Ä¢ Graceful degradation patterns</li>
            </ul>
          </div>
          <div>
            <h4 class="font-medium text-blue-800 mb-2">‚ö° Performance Optimizations</h4>
            <ul class="text-sm text-blue-700 space-y-1">
              <li>‚Ä¢ Request deduplication</li>
              <li>‚Ä¢ Background refetching</li>
              <li>‚Ä¢ Stale-while-revalidate pattern</li>
              <li>‚Ä¢ Memory-efficient caching</li>
            </ul>
          </div>
          <div>
            <h4 class="font-medium text-blue-800 mb-2">üîß Developer Experience</h4>
            <ul class="text-sm text-blue-700 space-y-1">
              <li>‚Ä¢ React Query DevTools integration</li>
              <li>‚Ä¢ TypeScript support throughout</li>
              <li>‚Ä¢ Declarative loading states</li>
              <li>‚Ä¢ Easy testing with mocks</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- API Demo Component -->
    <ApiDemo client:load />

    <!-- GitHub Actions Integration -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-12">
      <div class="bg-green-50 border border-green-200 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-green-900 mb-3">
          GitHub Actions Integration Flow
        </h3>
        <div class="grid grid-cols-1 gap-6">
          <div>
            <h4 class="font-medium text-green-800 mb-2">üîÑ Complete Workflow</h4>
            <ol class="text-sm text-green-700 space-y-2">
              <li><strong>1. Client Request:</strong> Form submission triggers API call</li>
              <li><strong>2. Repository Dispatch:</strong> Backend triggers GitHub Actions workflow</li>
              <li><strong>3. GitHub Processing:</strong> Workflow runs logo analysis, AI generation, and deployment</li>
              <li><strong>4. Webhook Updates:</strong> GitHub sends status updates to backend via webhooks</li>
              <li><strong>5. Client Polling:</strong> Frontend polls backend for latest status</li>
              <li><strong>6. Real-time UI:</strong> Progress updates display smoothly to user</li>
              <li><strong>7. Completion:</strong> Preview URL delivered when generation finishes</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <!-- Implementation Benefits -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-8">
      <div class="bg-gray-100 border border-gray-300 rounded-lg p-6">
        <h3 class="text-lg font-semibold text-gray-900 mb-3">
          Implementation Benefits
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h4 class="font-medium text-gray-800 mb-2">üéØ Technical Advantages</h4>
            <ul class="text-sm text-gray-700 space-y-1">
              <li>‚Ä¢ Perfect alignment with GitHub Actions</li>
              <li>‚Ä¢ No WebSocket server infrastructure needed</li>
              <li>‚Ä¢ Standard REST API patterns</li>
              <li>‚Ä¢ Better error handling and recovery</li>
              <li>‚Ä¢ Easier testing and mocking</li>
            </ul>
          </div>
          <div>
            <h4 class="font-medium text-gray-800 mb-2">üë• User Experience Benefits</h4>
            <ul class="text-sm text-gray-700 space-y-1">
              <li>‚Ä¢ Reliable progress tracking</li>
              <li>‚Ä¢ Better mobile and offline support</li>
              <li>‚Ä¢ Faster initial page loads</li>
              <li>‚Ä¢ Smoother error recovery</li>
              <li>‚Ä¢ Consistent behavior across devices</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>
</Layout>